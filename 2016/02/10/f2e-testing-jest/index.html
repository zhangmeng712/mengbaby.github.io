<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>前端自动化测试之单元测试（二）—— react组件的测试工具jest | 萌小主前端部落 | the more you know the more you know you don&#39;t know</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="nodejs,javascript,jest,React,前端单元测试">
    <meta name="description" content="前面介绍了Polymer的测试框架web-components-tester, 今天来看看React团队出品的Jest.在此,特别感谢婆婆帮忙带宝宝才让我有时间继续书写文章. 前面介绍了Polymer的测试框架web-components-tester, 今天来看看React团队出品的Jest.在此,特别感谢婆婆帮忙带宝宝才让我有时间继续书写文章. Jest的功能 内置jasmine 内置mock">
<meta name="keywords" content="nodejs,javascript,jest,React,前端单元测试">
<meta property="og:type" content="article">
<meta property="og:title" content="前端自动化测试之单元测试（二）—— react组件的测试工具jest">
<meta property="og:url" content="https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/index.html">
<meta property="og:site_name" content="萌小主前端部落">
<meta property="og:description" content="前面介绍了Polymer的测试框架web-components-tester, 今天来看看React团队出品的Jest.在此,特别感谢婆婆帮忙带宝宝才让我有时间继续书写文章. 前面介绍了Polymer的测试框架web-components-tester, 今天来看看React团队出品的Jest.在此,特别感谢婆婆帮忙带宝宝才让我有时间继续书写文章. Jest的功能 内置jasmine 内置mock">
<meta property="og:updated_time" content="2017-04-17T07:15:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端自动化测试之单元测试（二）—— react组件的测试工具jest">
<meta name="twitter:description" content="前面介绍了Polymer的测试框架web-components-tester, 今天来看看React团队出品的Jest.在此,特别感谢婆婆帮忙带宝宝才让我有时间继续书写文章. 前面介绍了Polymer的测试框架web-components-tester, 今天来看看React团队出品的Jest.在此,特别感谢婆婆帮忙带宝宝才让我有时间继续书写文章. Jest的功能 内置jasmine 内置mock">
    
        <link rel="alternate" type="application/atom+xml" title="萌小主前端部落" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@1.6.1/css/style.css">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpeg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Dr Meng</h5>
          <a href="mailto:zhangmeng712@gmail.com" title="zhangmeng712@gmail.com" class="mail">zhangmeng712@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zhangmeng712"  >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">前端自动化测试之单元测试（二）—— react组件的测试工具jest</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">前端自动化测试之单元测试（二）—— react组件的测试工具jest</h1>
        <h5 class="subtitle">
            
                <time datetime="2016-02-09T22:47:02.000Z" itemprop="datePublished" class="page-time">
  2016-02-10
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Uncategorized/">Uncategorized</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Jest的功能"><span class="post-toc-number">1.</span> <span class="post-toc-text">Jest的功能</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Jest用法"><span class="post-toc-number">2.</span> <span class="post-toc-text">Jest用法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一个简单的测试"><span class="post-toc-number">3.</span> <span class="post-toc-text">一个简单的测试</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#异步的单元测试实例"><span class="post-toc-number">4.</span> <span class="post-toc-text">异步的单元测试实例</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#React组件的单元测试实例"><span class="post-toc-number">5.</span> <span class="post-toc-text">React组件的单元测试实例</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#手动mock"><span class="post-toc-number">6.</span> <span class="post-toc-text">手动mock</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#代码参考"><span class="post-toc-number">7.</span> <span class="post-toc-text">代码参考</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-f2e-testing-jest"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">前端自动化测试之单元测试（二）—— react组件的测试工具jest</h1>
        <div class="post-meta">
            <time class="post-time" title="2016-02-10 06:47:02" datetime="2016-02-09T22:47:02.000Z"  itemprop="datePublished">2016-02-10</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Uncategorized/">Uncategorized</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>前面介绍了<a href="http://dj1211.com/?p=650" target="_blank" rel="external">Polymer</a>的测试框架web-components-tester, 今天来看看React团队出品的Jest.在此,特别感谢婆婆帮忙带宝宝才让我有时间继续书写文章.</p>
<p>前面介绍了<a target="_blank" href="http://dj1211.com/?p=650">Polymer</a>的测试框架web-components-tester, 今天来看看React团队出品的Jest.在此,特别感谢婆婆帮忙带宝宝才让我有时间继续书写文章.</p>
<h2 id="Jest的功能"><a href="#Jest的功能" class="headerlink" title="Jest的功能"></a>Jest的功能</h2><ul>
<li>内置jasmine</li>
<li>内置mock函数 可以mock模块</li>
<li>基于jsdom</li>
<li>同步化书写异步代码</li>
<li>真心赞一下简洁明了的API定义和用法 以及清晰的文档,确实让书写单元测试不再痛苦</li>
<li>适用于commonJS模块的单元测试</li>
<li>运行速度较慢</li>
</ul>
<h2 id="Jest用法"><a href="#Jest用法" class="headerlink" title="Jest用法"></a>Jest用法</h2><ul>
<li>安装: npm install jest-cli(需要node版本大于4)</li>
<li>配置 package.json 如下</li>
<li>运行: npm test</li>
<li>调试(使用node-debug再浏览器中调试)：node-debug –nodejs –harmony ./node_modules/jest-cli/bin/jest.js –runInBand <strong>tests</strong>/getUser-test.js</li>
<li>运行单个文件 ./node_modules/jest-cli/bin/jest.js <strong>tests</strong>/getUser-test.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"jest-test-examples"</span>,</div><div class="line">  <span class="string">"version"</span>: <span class="string">"0.0.1"</span>,</div><div class="line">  <span class="string">"dependencies"</span>: &#123;&#125;,</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"jest"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面就具体介绍一下使用jest进行测试的方法,采用的例子为jest的<a href="https://facebook.github.io/jest/docs/getting-started.html#content" target="_blank">官方实例</a></p>
<h2 id="一个简单的测试"><a href="#一个简单的测试" class="headerlink" title="一个简单的测试"></a>一个简单的测试</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">jest.dontMock(<span class="string">'../src/sum'</span>);</div><div class="line">describe(<span class="string">'sum'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    it(<span class="string">'adds 1 + 2 to equal 3'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> sum = <span class="built_in">require</span>(<span class="string">'../src/sum'</span>);</div><div class="line">        expect(sum(<span class="number">1</span>, <span class="number">2</span>)).toBe(<span class="number">3</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>describe和it还有expect都使用了jasmine的语法, jest会自动mock所有的依赖模块,对模块中所有的输出方法予以遍历并进行mock,对于要测试的模块使用jest.dontMock标识,jest就不会去mock.</p>
<h2 id="异步的单元测试实例"><a href="#异步的单元测试实例" class="headerlink" title="异步的单元测试实例"></a>异步的单元测试实例</h2><p>异步是javascript的灵魂, 所以异步的测试也是极其重要的,下面看看jest关于异步程序的测试,假如有这样个ajax程序,获取数据并进行解析,对其进行测试</p>
<ul>
<li>1 ajax的数据获取是否正确</li>
<li>2 parseUserJson是否正确<br>在第二个测试用例中使用了genMockFunction,用来对回调函数进行mock,在jest中有两种方式进行函数的mock<ul>
<li>1 使用xFunc = require(‘xx’);</li>
<li>2 使用xFunc = jest.genMockFunction();<br>使用后,会在xFunc.calls中存储有关函数的调用信息,例如</li>
<li>//mock.calls.length 记录了函数被调用了几次</li>
<li>//mock.calls[0][0]  被调用函数的第一个参数</li>
<li>//mock.calls[0][1]  第二个参数<br>代码如下: $.ajax是一个被mock的函数,callback也被mock,getUser(callback)调用后,可以通过检测传递的参数判断是否正确.</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseUserJson</span>(<span class="params">userJson</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">loggedIn</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">fullName</span>: userJson.firstName + <span class="string">' '</span> + userJson.lastName</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchCurrentUser</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> $.ajax(&#123;</div><div class="line">        <span class="attr">type</span>: <span class="string">'GET'</span>,</div><div class="line">        <span class="attr">url</span>: <span class="string">'http://example.com/currentUser'</span>,</div><div class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">userJson</span>) </span>&#123;</div><div class="line">            callback(parseUserJson(userJson));</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="built_in">module</span>.exports = fetchCurrentUser;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">jest.dontMock(<span class="string">'../src/getUser'</span>);</div><div class="line">describe(<span class="string">'getUser'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">//test right params</span></div><div class="line">    it(<span class="string">'calls into $.ajax with the correct params'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line">        <span class="keyword">var</span> getUser = <span class="built_in">require</span>(<span class="string">'../src/getUser'</span>);</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">dummyCallback</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">        getUser(dummyCallback);</div><div class="line">        <span class="comment">// Now make sure that $.ajax was properly called during the previous</span></div><div class="line">        <span class="comment">// 2 lines</span></div><div class="line">        expect($.ajax).toBeCalledWith(&#123;</div><div class="line">            <span class="attr">type</span>: <span class="string">'GET'</span>,</div><div class="line">            <span class="attr">url</span>: <span class="string">'http://example.com/currentUser'</span>,</div><div class="line">            <span class="attr">success</span>: jasmine.any(<span class="built_in">Function</span>)</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">//test callback function</span></div><div class="line">    it(<span class="string">'calls the callback when $.ajax requests are finished'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line">        <span class="keyword">var</span> getUser = <span class="built_in">require</span>(<span class="string">'../src/getUser'</span>);</div><div class="line"></div><div class="line">        <span class="comment">//create mock function</span></div><div class="line">        <span class="keyword">var</span> callback = jest.genMockFunction();</div><div class="line">        getUser(callback);</div><div class="line"></div><div class="line">        <span class="comment">//xfunc.mock have interactions information</span></div><div class="line">        <span class="comment">//mock.calls.length call times</span></div><div class="line">        <span class="comment">//mock.calls[0][0] first param</span></div><div class="line">        <span class="comment">//mock.calls[0][1] second param</span></div><div class="line">        <span class="comment">//https://facebook.github.io/jest/docs/mock-functions.html</span></div><div class="line"></div><div class="line">        <span class="comment">//emulate the params pass to success</span></div><div class="line">        $.ajax.mock.calls[<span class="number">0</span>][<span class="number">0</span>].success(&#123;</div><div class="line">            <span class="attr">firstName</span>: <span class="string">'Bobby'</span>,</div><div class="line">            <span class="attr">lastName</span>: <span class="string">'");DROP TABLE Users;--'</span></div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        expect(callback.mock.calls[<span class="number">0</span>][<span class="number">0</span>]).toEqual(&#123;</div><div class="line">            <span class="attr">loggedIn</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">fullName</span>: <span class="string">'Bobby ");DROP TABLE Users;--'</span></div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="React组件的单元测试实例"><a href="#React组件的单元测试实例" class="headerlink" title="React组件的单元测试实例"></a>React组件的单元测试实例</h2><p>假如我们有这样一个checkbox react组件, 如下, react的es6写法请参考我的blog-<a href="http://dj1211.com/?p=667" target="_blank">ES6的核心语法与应用</a><br>原理非常简单,点击checkbox切换label的状态.我们的测试代码如下, 使用了<a href="https://facebook.github.io/react/docs/test-utils.html" target="_blank">react-addons-test-utils</a>这个模块, 模块的renderIntoDocument用于将react组件渲染到document中,<br>并且支持产生模拟事件:TestUtils.Simulate.change.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Checkbox</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(props) &#123;</div><div class="line">        <span class="keyword">super</span>(props);</div><div class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">isChecked</span>: <span class="literal">false</span>&#125;;</div><div class="line">        <span class="keyword">this</span>.changeState = <span class="keyword">this</span>.changeState.bind(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    changeState () &#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">isChecked</span>: !<span class="keyword">this</span>.state.isChecked&#125;)</div><div class="line">    &#125;</div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span></div><div class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">checked</span>=<span class="string">&#123;this.state.isChecked&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.changeState&#125;</span> /&gt;</span></div><div class="line">                &#123;this.state.isChecked ? this.props.labelOn : this.props.labelOff&#125;</div><div class="line">               <span class="tag">&lt;/<span class="name">label</span>&gt;</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">export default Checkbox;</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> TestUtils <span class="keyword">from</span> <span class="string">'react-addons-test-utils'</span>;</div><div class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span>  <span class="string">'react-dom'</span>;</div><div class="line">jest.dontMock(<span class="string">'../src/checkbox'</span>);</div><div class="line"><span class="keyword">const</span> Checkbox = <span class="built_in">require</span>(<span class="string">'../src/checkbox'</span>);</div><div class="line"></div><div class="line">describe(<span class="string">'test react checkbox component'</span>, () =&gt; &#123;</div><div class="line">    it(<span class="string">'change the label after click'</span>, () =&gt; &#123;</div><div class="line">        <span class="comment">//1 render component</span></div><div class="line">        <span class="comment">//2 get node label get default value off</span></div><div class="line">        <span class="comment">//3 simulate click</span></div><div class="line">        <span class="comment">//4 expect value equal on</span></div><div class="line"></div><div class="line">        <span class="comment">//TestUtils.renderIntoDocument method refers to https://facebook.github.io/react/docs/test-utils.html#renderintodocument</span></div><div class="line">        <span class="comment">//TestUtils.findRenderedDOMComponentWithTag https://facebook.github.io/react/docs/test-utils.html#findrendereddomcomponentwithtag</span></div><div class="line">        <span class="comment">//ReactDom API:findDOMNode render unmountComponentAtNode server-side:renderToString renderToStaticMarkup</span></div><div class="line"></div><div class="line">        <span class="keyword">var</span> checkbox = TestUtils.renderIntoDocument(<span class="xml"><span class="tag">&lt;<span class="name">Checkbox</span> <span class="attr">labelOn</span>=<span class="string">"On"</span> <span class="attr">labelOff</span>=<span class="string">"Off"</span> /&gt;</span>);</span></div><div class="line">        var checkboxNode = ReactDom.findDOMNode(checkbox);</div><div class="line">        //https://facebook.github.io/jest/docs/api.html#expect-value</div><div class="line">        expect(checkboxNode.textContent).toEqual('Off');</div><div class="line">        TestUtils.Simulate.change(TestUtils.findRenderedDOMComponentWithTag(checkbox, 'input'));</div><div class="line">        expect(checkboxNode.textContent).toEqual('On');</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>运行的时候我们需要通过babel预处理一下,通过如下的方式配置package.json即可运行:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="string">"scripts"</span>: &#123;</div><div class="line">  <span class="string">"test"</span>: <span class="string">"jest"</span></div><div class="line">&#125;,</div><div class="line"><span class="string">"jest"</span>: &#123;</div><div class="line">  <span class="string">"scriptPreprocessor"</span>: <span class="string">"&lt;rootDir&gt;/node_modules/babel-jest"</span>,</div><div class="line">  <span class="string">"unmockedModulePathPatterns"</span>: [</div><div class="line">    <span class="string">"&lt;rootDir&gt;/node_modules/react"</span>,</div><div class="line">    <span class="string">"&lt;rootDir&gt;/node_modules/react-dom"</span>,</div><div class="line">    <span class="string">"&lt;rootDir&gt;/node_modules/react-addons-test-utils"</span></div><div class="line">  ],</div><div class="line">  <span class="string">"modulePathIgnorePatterns"</span>: [</div><div class="line">    <span class="string">"&lt;rootDir&gt;/node_modules/"</span></div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="手动mock"><a href="#手动mock" class="headerlink" title="手动mock"></a>手动mock</h2><p>经常我们需要模拟某个模块中的方法(此方法实现非常复杂依赖第三方的模块)用来测试另一个模块的输入输出是否正确,jest就提供非常方便的mock机制,例如,我们在A模块中依赖jquery的fx方法<br>而fx方法又依赖于其他方法, 因为我们只关心fx的输出,所以我们就可以直接用来模拟,方法如下:</p>
<ul>
<li>建立<strong>mocks</strong>文件夹</li>
<li>新建jquery模块:jquery.js</li>
<li>使用genMockFromModule和mockImplementation API 如下</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// mock the module of real jquery</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> jqueryMocks = jest.genMockFromModule(<span class="string">'jquery'</span>);</div><div class="line"><span class="keyword">var</span> mock_fx = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'mockValue'</span>;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//using mock_fx to mock the function of real fx</span></div><div class="line">jqueryMocks.fx.mockImplementation(mock_fx);</div><div class="line"><span class="built_in">module</span>.exports = jqueryMocks;</div></pre></td></tr></table></figure>
<p>这样就可以在测试代码中直接引用已经模拟好的fx函数进行测试了,直接对模块的输入控制,减少了依赖,实现测试的”解耦”.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">'jest mocks'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">   it(<span class="string">'jquery mock getEnv value'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">var</span> value = <span class="built_in">require</span>(<span class="string">'jquery'</span>).fx();</div><div class="line">       expect(value).toEqual(<span class="string">'mockValue'</span>)</div><div class="line">   &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="代码参考"><a href="#代码参考" class="headerlink" title="代码参考"></a>代码参考</h2><p><a href="https://github.com/zhangmeng712/f2e-testing/tree/master/un-tests/tests/react/basic" target="_blank">源码</a></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-04-17T07:15:39.000Z" itemprop="dateUpdated">2017-04-17 15:15:39</time>
</span><br>


        这里写留言或版权声明：<a href="/2016/02/10/f2e-testing-jest/" target="_blank" rel="external">https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/</a>
    </div>
    <footer>
        <a href="https://zhangmeng712.github.io">
            <img src="/img/avatar.jpeg" alt="Dr Meng">
            Dr Meng
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/Mtags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/Mtags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/Mtags/jest/">jest</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/Mtags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/Mtags/前端单元测试/">前端单元测试</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/&title=《前端自动化测试之单元测试（二）—— react组件的测试工具jest》 — 萌小主前端部落&pic=https://zhangmeng712.github.io/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/&title=《前端自动化测试之单元测试（二）—— react组件的测试工具jest》 — 萌小主前端部落&source=the more you know the more you know you don't know" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《前端自动化测试之单元测试（二）—— react组件的测试工具jest》 — 萌小主前端部落&url=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/&via=https://zhangmeng712.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2016/01/24/es6-basic/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ES6的核心语法与应用</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/03/10/f2e-testing-angular/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">前端自动化测试（三）- angular和protracor</h4>
      </a>
    </div>
  
</nav>



    




<section class="comments" id="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_shortname = 'data4q-com';
    lazyScripts.push('//' + disqus_shortname + '.disqus.com/embed.js')
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>







</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p>
            <span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></span>
            <span>Dr Meng &copy; 2017</span>
        </p>
        <p><a href="http://www.miitbeian.gov.cn/" target="_blank">京ICP备17021258号</a></p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/&title=《前端自动化测试之单元测试（二）—— react组件的测试工具jest》 — 萌小主前端部落&pic=https://zhangmeng712.github.io/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/&title=《前端自动化测试之单元测试（二）—— react组件的测试工具jest》 — 萌小主前端部落&source=the more you know the more you know you don't know" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《前端自动化测试之单元测试（二）—— react组件的测试工具jest》 — 萌小主前端部落&url=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/&via=https://zhangmeng712.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://zhangmeng712.github.io/2016/02/10/f2e-testing-jest/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMElEQVR42u3aSY6EQAwFUe5/aVrqVUvVQHwbSsIZuSoxFDwWVnrYNrz23/V55O8i9+4H6/Ps9sSSIUPGaxn76SIPOELyI+S5Fx9OhgwZCzB4oDyPdZ04efRc8uFkyJAhgwdQEqyP2OckGTJkyKgx+LaSh1cZMmTI6CSx927yyJWP5OIyZMh4ISNtDHzz94P9DRkyZLyEsYeLbBPTAtzeXjJkyJjNIGWydHii01qoNRJkyJCxAiN90X545ZtO3kKQIUPGbEbRWhqzqJXkEE+GDBkLMMjIV62UzwN6LcWVIUPGbEYaakkrsVPu58Nn6DYZMmSMYBAACab8c/BwXEybZciQMZTR0Z9fU/uH2vZUhgwZKzD4zWlgvWssI64aypAhYxyDh07++M5YRtrylCFDxgoMXlbjmz9yNh3sKA5byJAhYxCDB9B+CpoOWAQ7XBkyZCzAeDp95UMYwVvJkCFjNIOMMtRK9p1Q3rpShgwZ4xi1JJYHzVqimwZoGTJkTGXw9iEPxCSwpmntxVvJkCFjGQZvA3SakWn6ij6oDBkyRjPSon/6WnyEgofXi/+RIUPGOMYeLr7hq5X7yfF/SDJkyBjNSIMdCZ38bC00B41MGTJkDGLwVLaTxKYbvnQzKkOGjBUYtSCbjoXV2glBwJUhQ8byjDTVTAc4ak1QGTJkyOAZcFogS4ctLu6VIUPGAoy7kti0DEcKauiDypAhYzQjbQykhf7+uNgNzUsZMmS8lfEDkULWLEQzXgUAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };



</script>

<script src="//unpkg.com/hexo-theme-material-indigo@1.6.1/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@1.6.1/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '点我点我点我！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
